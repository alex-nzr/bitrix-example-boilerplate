this.BX=this.BX||{},this.BX.Vendor=this.BX.Vendor||{},this.BX.Vendor.Project=this.BX.Vendor.Project||{},function(e,t,i){"use strict";var n,a,o,l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,e),this.moduleId=t.moduleId,this.typeId=t.typeId,this.entityTypeId=t.entityTypeId,this.entityId=t.entityId,this.isNew=t.isNew,this.pageTitleEditable=t.pageTitleEditable,this.enableCategorySelector=t.enableCategorySelector,this.cardConfigEditable=t.cardConfigEditable,this.enableSectionCreation=t.enableSectionCreation,this.enableSectionEdit=t.enableSectionEdit,this.enableFieldsContextMenu=t.enableFieldsContextMenu,this.enableSectionEditMode=t.enableSectionEditMode,this.showEmptySections=t.showEmptySections,this.enableCommunicationControls=t.enableCommunicationControls,this.hideTimelineInCreationPage=t.hideTimelineInCreationPage,this.isStageFlowActive=t.isStageFlowActive,this.reloadOnStageChange=t.reloadOnStageChange,this.init()}return babelHelpers.createClass(e,[{key:"init",value:function(){this.customizeStageFlow(),this.customizePageTitleBlock(),this.addCssClasses(),this.initEvents()}},{key:"initEvents",value:function(){var e=this;BX.ready((function(){BX.addCustomEvent("BX.Crm.EntityEditor:onBeforeLayout",(function(t){e.enableCommunicationControls||(t._enableCommunicationControls=!1),e.cardConfigEditable||t._config&&(t._enableConfigControl=!1,t._config._canUpdateCommonConfiguration=!1,t._config._canUpdatePersonalConfiguration=!1,t._config._enableScopeToggle=!1),e.enableSectionCreation||(t._enableSectionCreation=!1),e.cardConfigEditable||e.enableSectionCreation||(t._enableBottomPanel=!1),e.enableSectionEdit||(t._enableSectionEdit=!1),e.enableFieldsContextMenu||(t._enableFieldsContextMenu=!1),e.pageTitleEditable||(t._enablePageTitleControls=!1,t._model&&(t._model.isCaptionEditable=function(){return!1})),t.getMode(),BX.UI.EntityEditorMode.edit,t.saveScheme()})),BX.addCustomEvent("BX.Crm.EntityEditorSection:onLayout",(function(t){t.getMode(),BX.UI.EntityEditorMode.edit,e.enableSectionEditMode||(BX.type.isDomNode(t._titleActions)&&t._titleActions.remove(),t._schemeElement._isEditable=!1,t.saveScheme());var i=t.getChildren();i.length<=0?e.showEmptySections||BX.type.isDomNode(t._wrapper)&&t._wrapper.classList.add("ui-element-hidden"):i.forEach((function(e){}))})),BX.addCustomEvent("BX.UI.EntityEditorField:onLayout",(function(e){})),BX.addCustomEvent("BX.Crm.ItemDetailsComponent:onStageChange",(function(){var t,i;e.reloadOnStageChange&&(null!==(t=BX.SidePanel)&&void 0!==t&&null!==(i=t.Instance)&&void 0!==i&&i.opened?BX.SidePanel.Instance.reload():window.location.reload())}))}))}},{key:"prepareFieldParams",value:function(e){if([].includes(e._id)){e._schemeElement._isEditable=!1,e.saveScheme();var t=e._wrapper.querySelectorAll("[name^='"+e._id+"'], [name^='"+e._id+"[]'], i.date.icon");t.length&&t.forEach((function(e){e.setAttribute("disabled",!0),e.onclick=function(){return!1}}))}}},{key:"addCssClasses",value:function(){this.isNew&&(document.body.classList.add("editor-mode-new-item-creation"),this.hideTimelineInCreationPage&&document.body.classList.add("editor-mode-hide-timeline-column"))}},{key:"customizePageTitleBlock",value:function(){var e;if(null!==(e=BX.Crm)&&void 0!==e&&e.ItemDetailsComponent){var i=this;BX.Crm.ItemDetailsComponent.prototype.initPageTitleButtons=function(){var e=t.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span id="pagetitle_btn_wrapper" class="pagetitile-button-container">\n\t\t\t\t\t<span id="page_url_copy_btn" class="crm-page-link-btn"></span>\n\t\t\t\t</span>\n\t\t\t'])));if(i.pageTitleEditable){var l=t.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span id="pagetitle_edit" class="pagetitle-edit-button"></span>\n\t\t\t\t'])));t.Dom.prepend(l,e)}var s=document.getElementById("pagetitle");if(t.Dom.insertAfter(e,s),i.enableCategorySelector&&t.Type.isArray(this.categories)&&this.categories.length>0){var d=this.getCurrentCategory();if(d){var r=t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<div id="pagetitle_sub" class="pagetitle-sub">\n\t\t\t\t\t\t\t\t<a href="#" onclick="','">',"</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"])),this.onCategorySelectorClick.bind(this),d.text);t.Dom.insertAfter(r,e)}}}}else console.log("BX.Crm.ItemDetailsComponent is undefined")}},{key:"customizeStageFlow",value:function(){var e;if(null!==(e=BX.Crm)&&void 0!==e&&e.ItemDetailsComponent){var n=this;BX.Crm.ItemDetailsComponent.prototype.initStageFlow=function(){if(this.stages){var e=this.prepareStageFlowStagesData(),a=document.querySelector('[data-role="stageflow-wrap"]');a&&(n.isStageFlowActive||a.classList.add("ui-element-disabled"),this.stageflowChart=new i.StageFlow.Chart({backgroundColor:"d3d7dc",currentStage:this.currentStageId,isActive:n.isStageFlowActive,onStageChange:this.onStageChange.bind(this),labels:{finalStageName:t.Loc.getMessage("CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_NAME"),finalStagePopupTitle:t.Loc.getMessage("CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_POPUP"),finalStagePopupFail:t.Loc.getMessage("CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_POPUP_FAIL"),finalStageSelectorTitle:t.Loc.getMessage("CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_SELECTOR")}},e),a.appendChild(this.stageflowChart.render()))}}}else console.log("BX.Crm.ItemDetailsComponent is undefined")}}]),e}();e.EntityDetailManager=l}(this.BX.Vendor.Project.Dynamic=this.BX.Vendor.Project.Dynamic||{},BX,BX.UI);
//# sourceMappingURL=index.bundle.js.map
